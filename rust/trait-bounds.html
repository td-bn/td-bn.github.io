<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Trait and trait-bounds</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Trait and trait-bounds</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        <div class="sidebar-tools-collapse">
    <a href="https://github.com/td-bn" title="" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle sidebar-tool" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Programming</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Rust</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../rust/types-alignment-and-layout.html" class="sidebar-item-text sidebar-link">Alignment and memory layout of types</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../rust/async-await.html" class="sidebar-item-text sidebar-link">Async/Await</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../rust/chanells.html" class="sidebar-item-text sidebar-link">Channels and sync primitives</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../rust/coherance-and-orphan-rules.html" class="sidebar-item-text sidebar-link">Coherence and Orphan Rules</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../rust/declarative_macros.html" class="sidebar-item-text sidebar-link">Declerative macros</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../rust/errors.html" class="sidebar-item-text sidebar-link">Errors</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../rust/foundations.html" class="sidebar-item-text sidebar-link">Foundations</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../rust/iter.html" class="sidebar-item-text sidebar-link">Iterators</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../rust/ownership.html" class="sidebar-item-text sidebar-link">Ownership, Borrowing and Lifetimes</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../rust/pointers.html" class="sidebar-item-text sidebar-link">Smart pointers and Interior Mutability</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../rust/trait-bounds.html" class="sidebar-item-text sidebar-link active">Trait and trait-bounds</a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">Decentralization</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">tbDEX and SSI</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../decentralization/tbd/tdDEX.html" class="sidebar-item-text sidebar-link">tbDEX: Foundations, participants and flow</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false">Bitcoin</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../decentralization/btc/btc-transactions2.html" class="sidebar-item-text sidebar-link">Bitcoin scripting</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../decentralization/btc/btc-transactions.html" class="sidebar-item-text sidebar-link">Bitcoin Transactions</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../decentralization/btc/btc-conditionals.html" class="sidebar-item-text sidebar-link">Conditional Flows</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../decentralization/btc/btc-segwit.html" class="sidebar-item-text sidebar-link">SegWit</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../decentralization/btc/btc-timelocks.html" class="sidebar-item-text sidebar-link">Timelocks</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false">LN⚡</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../decentralization/ln⚡/channel-construction.html" class="sidebar-item-text sidebar-link">Channel construction</a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">ML/AI</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai/lesson_1.html" class="sidebar-item-text sidebar-link">Is it a duck or a swan?</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#dynamically-sized-typesdst" id="toc-dynamically-sized-typesdst" class="nav-link active" data-scroll-target="#dynamically-sized-typesdst">Dynamically Sized Types(DST)</a>
  <ul class="collapse">
  <li><a href="#fat-pointers" id="toc-fat-pointers" class="nav-link" data-scroll-target="#fat-pointers">Fat pointers</a></li>
  </ul></li>
  <li><a href="#traits-and-trait-bounds" id="toc-traits-and-trait-bounds" class="nav-link" data-scroll-target="#traits-and-trait-bounds">Traits and Trait Bounds</a>
  <ul class="collapse">
  <li><a href="#static-dispatch" id="toc-static-dispatch" class="nav-link" data-scroll-target="#static-dispatch">Static dispatch</a></li>
  </ul></li>
  <li><a href="#dynamic-dispatch" id="toc-dynamic-dispatch" class="nav-link" data-scroll-target="#dynamic-dispatch">Dynamic Dispatch</a>
  <ul class="collapse">
  <li><a href="#trait-objects" id="toc-trait-objects" class="nav-link" data-scroll-target="#trait-objects">Trait objects</a></li>
  <li><a href="#pros-and-cons-of-dynamic-dispatch" id="toc-pros-and-cons-of-dynamic-dispatch" class="nav-link" data-scroll-target="#pros-and-cons-of-dynamic-dispatch">Pros and cons of dynamic dispatch</a></li>
  <li><a href="#choosing-between-dynamic-and-static-dispatch" id="toc-choosing-between-dynamic-and-static-dispatch" class="nav-link" data-scroll-target="#choosing-between-dynamic-and-static-dispatch">Choosing between dynamic and static dispatch</a></li>
  </ul></li>
  <li><a href="#trait-bounds" id="toc-trait-bounds" class="nav-link" data-scroll-target="#trait-bounds">Trait bounds</a>
  <ul class="collapse">
  <li><a href="#higher-ranked-trait-bounds" id="toc-higher-ranked-trait-bounds" class="nav-link" data-scroll-target="#higher-ranked-trait-bounds">Higher-ranked trait bounds</a></li>
  </ul></li>
  <li><a href="#marker-traits" id="toc-marker-traits" class="nav-link" data-scroll-target="#marker-traits">Marker Traits</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Trait and trait-bounds</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="dynamically-sized-typesdst" class="level2">
<h2 class="anchored" data-anchor-id="dynamically-sized-typesdst">Dynamically Sized Types(DST)</h2>
<p>Most Rust types are <code>Sized</code> i.e.&nbsp;they have a size that is known at compile time. Two common exceptions to this are trait objects and slices(e.g <code>dyn Iterator</code> or <code>[u8]</code>)</p>
<p>Their size depends on some information that is available only when the program is run and not at compile time. That is why they are called <em>dynamically sized traits</em>.</p>
<p>The compiler requires types to be <code>Sized</code> nearly everywhere: struct fields, function arguments, return values, variable types and array types. Every single type bound we write has <code>T: Sized</code> by default, unless we opt out.</p>
<p>The way to bridge this gap between the unsized and sized types is to place unsized types behind a <em>wide pointer</em> (fat pointer).</p>
<section id="fat-pointers" class="level3">
<h3 class="anchored" data-anchor-id="fat-pointers">Fat pointers</h3>
<p>A wide/fat pointer is like other pointers, but it includes an extra word-sized field that gives additional information required by the compiler to generate reasonable code for working with the pointer.</p>
<p><em><strong>Wide/fat pointers are <code>Sized</code></strong></em> Specifically they are twice the size of a <code>usize</code>, one usize to hold the pointer type and another to hold the additional information required by the compiler.</p>
<blockquote class="blockquote">
<p>NOTE: <code>Box</code> and <code>Arc</code> also support storing wide/fat pointers. That is why they support <code>T: ?Sized</code></p>
</blockquote>
</section>
</section>
<section id="traits-and-trait-bounds" class="level2">
<h2 class="anchored" data-anchor-id="traits-and-trait-bounds">Traits and Trait Bounds</h2>
<p>Traits are the glue that allow Rust types to interoperate even though they don’t know about each other at the time they are defined.</p>
<section id="how-are-generics-used-in-rust" class="level5">
<h5 class="anchored" data-anchor-id="how-are-generics-used-in-rust">How are generics used in Rust?</h5>
<p>The compiler replaces the generic types with actual types in the code that involves generics. We are basically telling the compiler to make a copy of that function for each type T it is used with.</p>
</section>
<section id="static-dispatch" class="level3">
<h3 class="anchored" data-anchor-id="static-dispatch">Static dispatch</h3>
<p>Consider the code:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode rust code-with-copy"><code class="sourceCode rust"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">impl</span> <span class="dt">String</span> <span class="op">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">pub</span> <span class="kw">fn</span> contains(<span class="op">&amp;</span><span class="kw">self</span><span class="op">,</span> p<span class="op">:</span> <span class="kw">impl</span> <span class="bu">Pattern</span>) <span class="op">-&gt;</span> <span class="dt">bool</span> <span class="op">{</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    p<span class="op">.</span>is_contained_in(<span class="kw">self</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The compiler needs a different copy of the function body of each <code>impl Pattern</code> type because it needs to know the address of the <code>is_contained_in</code> function to call it. The CPU needs to be told where to jump and continue execution.</p>
<p>This is referred to as <em>static dispatch</em> because the address we are dispatching to is known at compile time.</p>
<p>This process of going from a generic type to a non-generic type is called <code>monomorphization</code>.</p>
<section id="cost-of-monomorphization" class="level5">
<h5 class="anchored" data-anchor-id="cost-of-monomorphization">Cost of monomorphization</h5>
<ol type="1">
<li>All instances of non-generic types must be compiled separately which increases the compile time.</li>
<li>Each monomorphized function results in its own chunk of machine code, thus making the program larger.</li>
<li>CPU’s instruction cache is also less effective as instructions are not shared between different instantiations of the a generic type’s methods. It needs to hold multiple copies of effectively the same instructions.</li>
</ol>
<blockquote class="blockquote">
<p>One pattern is to declare a non-generic helper function to perform shared operations.</p>
</blockquote>
</section>
</section>
</section>
<section id="dynamic-dispatch" class="level2">
<h2 class="anchored" data-anchor-id="dynamic-dispatch">Dynamic Dispatch</h2>
<p>Enables code to call a trait method on a generic type without knowing what that type is.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode rust code-with-copy"><code class="sourceCode rust"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">impl</span> <span class="dt">String</span> <span class="op">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">pub</span> <span class="kw">fn</span> contains(<span class="op">&amp;</span><span class="kw">self</span><span class="op">,</span> p<span class="op">:</span> <span class="op">&amp;</span><span class="kw">dyn</span> <span class="bu">Pattern</span>) <span class="op">-&gt;</span> <span class="dt">bool</span> <span class="op">{</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    p<span class="op">.</span>is_contained_in(<span class="kw">self</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We are basically telling that the caller must give two pieces of information: - the address of the pattern - the address of the method <code>is_contained_in</code></p>
<p>In practise the address of the <code>vtable</code> is passed to the method. The <code>vtable</code> contains the address of all the implementations of all the trait’s methods.</p>
<p>This allows us to use the same function body regardless of the type of the caller wants to use.</p>
<p>See playground example <a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=1ae1f32c71726d7c48c07856468ad2be">here</a></p>
<section id="trait-objects" class="level3">
<h3 class="anchored" data-anchor-id="trait-objects">Trait objects</h3>
<p>The combination of a type that implements a trait and its vtable are known as a <em>trait object</em>. Most traits can be turned into trait objects but not all.</p>
<p>Only traits which are <em>object-safe</em> can be turned into trait objects.</p>
<p>To be object-safe: - none of the traits methods can be generic or use the Self type - the trait cannot have any static methods, since it would be impossible to know which method to call</p>
<p>Using the <code>Self: Sized</code> bound imples that Self is not being used through a trait object, because otherwise it would be <code>!Sized</code>. We can place that bound on a trait to require that a trait never uses dynamic dispatch, or it can be placed on a specific method to specify that the method should never be used through a trait object.</p>
</section>
<section id="pros-and-cons-of-dynamic-dispatch" class="level3">
<h3 class="anchored" data-anchor-id="pros-and-cons-of-dynamic-dispatch">Pros and cons of dynamic dispatch</h3>
<p>Pros: - cuts compile time - improve efficiency of CPU instruction cache</p>
<p>Cons: - prevents the compiler from optimizing for specific types - every lookup from the vtable adds a small overhead over calling methods directly</p>
</section>
<section id="choosing-between-dynamic-and-static-dispatch" class="level3">
<h3 class="anchored" data-anchor-id="choosing-between-dynamic-and-static-dispatch">Choosing between dynamic and static dispatch</h3>
<p>Rule of thumb: <em>Use static dispatch in libraries and dynamic dispatch in you binaries</em></p>
<p>We want to allow the user to decide what kind of dispatch is best for them in a library. Dynamic dispatch forces the users to do the same, whereas with static dispatch they can choose whether to use dynamic dispatch or not.</p>
<p>For binaries, we are writing the final code, hence if cleaner code, leaving our generic parameter, quicker compile times at the cost marginal performance sound okay, its a better choice for binaries.</p>
</section>
</section>
<section id="trait-bounds" class="level2">
<h2 class="anchored" data-anchor-id="trait-bounds">Trait bounds</h2>
<p>Bounds can be any type restrictions. They do not need to include generic parameters, types of arguments or local types.</p>
<p><code>where String: Clone</code> is a valid trait bound.</p>
<p><code>where io::Error: From&lt;MyError&lt;T&gt;&gt;</code> is also valid. Generic type parameters do not need to appear only on the left side. This is useful to express more intricate trait bounds. It can also save one from needlessly repeating bounds.</p>
<p>e.g.</p>
<p>To construct a <code>HashMap&lt;T,V,S&gt;</code> where keys are some generic tyype <code>T</code> and whose value is <code>usize</code>, we can use:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode rust code-with-copy"><code class="sourceCode rust"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">where</span> HashMap<span class="op">&lt;</span>T<span class="op">,</span><span class="dt">usize</span><span class="op">,</span>S<span class="op">&gt;:</span> <span class="bu">FromIterator</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>instead of</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode rust code-with-copy"><code class="sourceCode rust"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">where</span> T<span class="op">:</span><span class="bu">Hash</span><span class="op">+</span><span class="bu">Eq</span><span class="op">,</span> S<span class="op">:</span><span class="bu">BuildHasher</span><span class="op">+</span><span class="bu">Default</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This also clearly communicates the ‘true’ requirements of the code.</p>
<p>We can also write bounds for associated types of types we’re generic over. We can refer to the associated type using the syntax:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode rust code-with-copy"><code class="sourceCode rust"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>Type <span class="kw">as</span> Trait<span class="op">&gt;</span><span class="pp">::</span>AssocType</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>See: https://doc.rust-lang.org/std/iter/struct.Flatten.html</p>
<section id="higher-ranked-trait-bounds" class="level3">
<h3 class="anchored" data-anchor-id="higher-ranked-trait-bounds">Higher-ranked trait bounds</h3>
<p>When working with generic references to a type, writing bounds requires a generic lifetime parameter that we can use a lifetime for the references.</p>
<p>Sometimes thought, we also want the baility to say that <em>this reference implements this trait for any lifetime</em>. This type of bound is known as a higher-ranked trait bound, is is useful in associations with the Fn trait.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode rust code-with-copy"><code class="sourceCode rust"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>wher F<span class="op">:</span> <span class="cf">for</span><span class="op">&lt;</span><span class="ot">'a</span><span class="op">&gt;</span> <span class="bu">Fn</span>(<span class="op">&amp;</span><span class="ot">'a</span> T) <span class="op">-&gt;</span> <span class="op">&amp;</span><span class="ot">'a</span> U</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We are saying that for any lifetime ’a, the bound must hold.</p>
<p>The compiler is smart enough to automatically add the <code>for</code> when we write <code>Fn</code> bounds with references like this, which covers the majority of use cases. The explicit form is needed exceedingly rarely.</p>
<p>Example that implement <code>Debug</code> for any type that can be Iterated over and whose elements are <code>Debug</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode rust code-with-copy"><code class="sourceCode rust"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">impl</span> <span class="bu">Debug</span> <span class="cf">for</span> AnyIterable</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> <span class="cf">for</span><span class="op">&lt;</span><span class="ot">'a</span><span class="op">&gt;</span> <span class="op">&amp;</span><span class="ot">'a</span> <span class="dt">Self</span><span class="op">:</span> <span class="bu">IntoIterator</span><span class="op">,</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span><span class="op">&lt;</span><span class="ot">'a</span><span class="op">&gt;</span> <span class="op">&lt;&amp;</span><span class="ot">'a</span> <span class="dt">Self</span> <span class="kw">as</span> <span class="bu">IntoIterator</span><span class="op">&gt;</span><span class="pp">::</span>Item<span class="op">:</span> <span class="bu">Debug</span> <span class="op">{</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> fmt(<span class="op">&amp;</span><span class="kw">self</span><span class="op">,</span> f<span class="op">:</span> <span class="op">&amp;</span><span class="kw">mut</span> Formatter) <span class="op">-&gt;</span> <span class="dt">Result</span>(()<span class="op">,</span> Erro) <span class="op">{</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>        f<span class="op">.</span>debug_list()<span class="op">.</span>enteries(<span class="kw">self</span>)<span class="op">.</span>finish()</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span>   </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="marker-traits" class="level2">
<h2 class="anchored" data-anchor-id="marker-traits">Marker Traits</h2>
<p>Usually we use traits to denote functionality that multiple types support e.g a <code>Hash</code> type can be hashed by calling <code>hash</code>. But not all traits are functional.</p>
<p><code>Marker traits</code> indicate a property of the implementing type. Marker traits have no methods or associated types, and serve just to tell you that a particular type can or cannot be used in a certain way.</p>
<p>e.g.&nbsp;A type that is <code>Send</code> is safe to send across thread boundaries. There are no methods associated with this behaviour. It is just a fact about the type.</p>
<p><code>std::marker</code> has a number of these including <code>Send, Sync, Copy, Sized and Unpin</code></p>
<p>Most of these (except Copy) are auto-traits. That means that the compiler automatically implements them for types unless the type contains something that does not implement the marker trait.</p>
<p>Marker traits are important because <em>they allow us to write bounds that capture the tsemantic requirements not directly expressed in the code</em>.</p>
<p>Unit types (e.g.&nbsp;<code>MyMarker</code>) serve a function similar to marker types. They hold no data and have no methods. They are useful for marking a type in a particular state.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center">This website that is build using <a href="https://quarto.org/docs/websites">Quarto</a>.</div>
  </div>
</footer>



</body></html>